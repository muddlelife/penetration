# 绕过CDN查找网站真实IP

## CDN
    
> CDN作为内容分发网络，主要解决因传输距离和不同运营商节点造成的网络速度性能低下的问题，就是一组在不同运营商之间的对接点上的高速缓存服务器，把用户经常访问的静态数据资源直接缓存到节点服务器上，当用户再次请求时，会直接分发到离用户近的节点服务器上响应给用户，当用户有实际数据交互时才会从远程web服务器上响应，这样可以提高网站的响应速度及用户体验

CDN优势

* 提高用户访问速率，优化用户使用体验

* 隐藏真实服务器的IP

* 提供WAF功能，目前很多CDN也提供了WAF的功能，我们的访问请求会先经过CDN节点的过滤，该过滤可对SQL注入、XSS、Webshell上传、命令注入、恶意扫描等攻击行为进行有效监测和拦截。CDN节点将认为无害的数据提交给真实的主机服务器

* 因此我们在渗透过程中，我们必须要知道网站的真实IP地址，所以我们需要绕过CDN

## 绕过CDN

* 判断网站是否存在CDN
    
    采用多地ping的方式，如果ip地址唯一，则没有CDN，而那个ip则为网站的真实ip，不唯一，则网站非常有可能的存在CDN

* 绕过CDN

    * 子域名查询
    
        CDN很贵，有可能网站管理员只对主站或者流量大的子站点做了CDN，而很多小子站站点又跟主站在同一台服务器或者一个网段内，这样可以通过查询子域名对应的IP来辅助查找网站的真实IP
        
        子域名爆破oneforall、google hacking

    * 查询主域名

        一些网站在使用CDN时，只让WWW域名使用CDN，光有域名则不用，这样可以维护网站更方便，不用等CDN缓存。所以试着把目标网站的www去掉，ping一下ip，这样是真实ip的可能性也很大

    * 邮件服务器

        一般的邮件系统都在内部，没有经过CDN的解析，通过目标网站用户注册或在RSS订阅功能，查看邮件，寻找有箭头中的邮件服务器域名ip，ping这个邮件服务器的域名，就可以获得目标的真实ip（第三方或者公共邮件服务器不可以）

    * 查看域名历史解析记录

        有可能网站初期由于流量较少，访问人数不多，有可能没有使用过CDN，那么可能存在使用CDN之前的记录，有可能存在ip

    * 国外访问

        国内的CDN往往只对国内用户的访问加速，而国外的CDN就不一定了，可以通过国外在先代理网站访问，可能会得到真实的ip地址

    * Nslookup查询

        查询域名的NS记录、MX记录、TXT记录，这里面可能存在真实ip地址

    * 网站漏洞

        利用网站自身存在的漏洞，很多情况下会泄露服务器的真实ip地址

    * Censys查询SSL证书找到真实ip

        利用Censys网络空间搜索引擎搜索网站的SSL证书及HASH，在一些网站上查找目标网站SSL证书的HASH，然后再用Censys搜索该HASH即可得到真实IP地址
